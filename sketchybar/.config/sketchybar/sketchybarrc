#!/bin/bash

# SketchyBar configuration with AeroSpace workspace integration
# Base16 One Dark color scheme

PLUGIN_DIR="$CONFIG_DIR/plugins"

# Base16 One Dark colors
BASE00=0xff282c34  # Background
BASE07=0xffc8ccd4  # Foreground
BASE08=0xffe06c75  # Red
BASE09=0xffd19a66  # Orange
BASE0A=0xffe5c07b  # Yellow
BASE0B=0xff98c379  # Green
BASE0D=0xff61afef  # Blue
BASE0E=0xffc678dd  # Purple

##### Bar Appearance #####
sketchybar --bar position=bottom \
                 height=20 \
                 blur_radius=50 \
                 color=0xf0282c34 \
                 topmost=window

##### Changing Defaults #####
default=(
  padding_left=5
  padding_right=5
  icon.font="LigaSFMonoNerdFont:Bold:14.0"
  label.font="LigaSFMonoNerdFont:Regular:13.0"
  icon.color="$BASE07"
  label.color="$BASE07"
  icon.padding_left=4
  icon.padding_right=4
  label.padding_left=4
  label.padding_right=4
)
sketchybar --default "${default[@]}"

##### AeroSpace Workspace Indicators #####
# Add event for aerospace workspace changes
sketchybar --add event aerospace_workspace_change

# OS indicator (leftmost position)
# Shows ▲ on macOS, ♜ on Linux
if [[ "$OSTYPE" == "darwin"* ]]; then
  OS_ICON="▲"
else
  OS_ICON="♜"
fi

sketchybar --add item os_indicator left \
           --set os_indicator \
           icon="$OS_ICON" \
           icon.color="$BASE07" \
           icon.padding_left=8 \
           icon.padding_right=4 \
           label.drawing=off

# Create workspace indicators for all aerospace workspaces
for sid in $(aerospace list-workspaces --all); do
  sketchybar --add item space.$sid left \
             --subscribe space.$sid aerospace_workspace_change \
             --set space.$sid \
             background.color="$BASE0D" \
             background.corner_radius=0 \
             background.height=20 \
             background.drawing=off \
             icon.drawing=off \
             label="$sid" \
             label.color="$BASE07" \
             label.align=center \
             label.width=24 \
             padding_left=2 \
             padding_right=2 \
             click_script="aerospace workspace $sid" \
             script="$PLUGIN_DIR/aerospace.sh $sid"
done

# Fullscreen indicator (right of workspaces)
sketchybar --add item fullscreen left \
           --set fullscreen \
           icon.font="LigaSFMonoNerdFont:Bold:18.0" \
           icon.color="$BASE0B" \
           icon.padding_left=4 \
           icon.padding_right=8 \
           label.drawing=off \
           script="$PLUGIN_DIR/fullscreen.sh" \
           --subscribe fullscreen aerospace_workspace_change

##### Adding Right Items #####
# Add keyboard change event and clock update event
sketchybar --add event keyboard_change
sketchybar --add event clock_update

# Right side items (ordered right to left): Time/Date, Keyboard, Volume, Battery, Camera, Weather
# Note: Items are added in order, first item appears rightmost
sketchybar --add item clock right \
           --set clock \
           update_freq=10 \
           icon.color="$BASE0A" \
           label.color="$BASE07" \
           script="$PLUGIN_DIR/clock.sh" \
           click_script="$CONFIG_DIR/scripts/toggle-clock.sh" \
           --subscribe clock clock_update \
           \
           --add item keyboard right \
           --set keyboard \
           update_freq=3 \
           icon.color="$BASE0B" \
           label.color="$BASE07" \
           script="$PLUGIN_DIR/keyboard.sh" \
           click_script="$CONFIG_DIR/scripts/toggle-keyboard.sh" \
           --subscribe keyboard keyboard_change \
           \
           --add item volume right \
           --set volume \
           icon.color="$BASE0E" \
           label.color="$BASE07" \
           script="$PLUGIN_DIR/volume.sh" \
           --subscribe volume volume_change \
           \
           --add item battery right \
           --set battery \
           update_freq=120 \
           icon.color="$BASE0E" \
           label.color="$BASE07" \
           script="$PLUGIN_DIR/battery.sh" \
           --subscribe battery system_woke power_source_change \
           \
           --add item network right \
           --set network \
           update_freq=10 \
           icon.color="$BASE0E" \
           label.color="$BASE07" \
           script="$PLUGIN_DIR/network.sh" \
           click_script="open x-apple.systempreferences:com.apple.Network-Settings.extension" \
           \
           --add item weather right \
           --set weather \
           update_freq=900 \
           icon.color="$BASE0D" \
           label.color="$BASE07" \
           script="$PLUGIN_DIR/weather.sh" \
           click_script="$CONFIG_DIR/scripts/click-weather.sh"

##### Force all scripts to run the first time (never do this in a script) #####
sketchybar --update

##### Switch to workspace 1 on startup/reload #####
aerospace workspace 1
